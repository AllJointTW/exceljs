{"version":3,"file":"table-xform.js","names":["XmlStream","require","BaseXform","ListXform","AutoFilterXform","TableColumnXform","TableStyleInfoXform","undefinedOrResult","test","result","undefined","TableXform","map","autoFilter","tableColumns","tag","count","empty","childXform","tableStyleInfo","model","options","prepare","columns","xmlStream","openXml","StdDocAttributes","openNode","TABLE_ATTRIBUTES","id","name","displayName","ref","tableRef","totalsRowCount","totalsRow","headerRowCount","headerRow","render","style","closeNode","node","parser","parseOpen","attributes","reset","text","parseText","parseClose","autoFilterRef","forEach","column","index","filterButton","dxfId","styles","getDxfStyle","xmlns","module","exports"],"sources":["../../../../../lib/xlsx/xform/table/table-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\nconst ListXform = require('../list-xform');\n\nconst AutoFilterXform = require('./auto-filter-xform');\nconst TableColumnXform = require('./table-column-xform');\nconst TableStyleInfoXform = require('./table-style-info-xform');\n\nconst undefinedOrResult = (test, result) => (typeof test === 'undefined' ? undefined : result);\n\nclass TableXform extends BaseXform {\n  constructor() {\n    super();\n\n    this.map = {\n      autoFilter: new AutoFilterXform(),\n      tableColumns: new ListXform({\n        tag: 'tableColumns',\n        count: true,\n        empty: true,\n        childXform: new TableColumnXform(),\n      }),\n      tableStyleInfo: new TableStyleInfoXform(),\n    };\n  }\n\n  prepare(model, options) {\n    this.map.autoFilter.prepare(model);\n    this.map.tableColumns.prepare(model.columns, options);\n  }\n\n  get tag() {\n    return 'table';\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode(this.tag, {\n      ...TableXform.TABLE_ATTRIBUTES,\n      id: model.id,\n      name: model.name,\n      displayName: model.displayName || model.name,\n      ref: model.tableRef,\n      totalsRowCount: undefinedOrResult(model.totalsRow, model.totalsRow ? '1' : '0'),\n      // totalsRowShown: model.totalsRow ? undefined : '1',\n      headerRowCount: undefinedOrResult(model.headerRow, model.headerRow ? '1' : '0'),\n    });\n\n    this.map.autoFilter.render(xmlStream, model);\n    this.map.tableColumns.render(xmlStream, model.columns);\n    this.map.tableStyleInfo.render(xmlStream, model.style);\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    const {name, attributes} = node;\n    switch (name) {\n      case this.tag:\n        this.reset();\n        this.model = {\n          name: attributes.name,\n          displayName: attributes.displayName || attributes.name,\n          tableRef: attributes.ref,\n          totalsRow: undefinedOrResult(attributes.totalsRowCount, attributes.totalsRowCount === '1'),\n          headerRow: undefinedOrResult(attributes.headerRowCount, attributes.headerRowCount === '1'),\n        };\n        break;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n        }\n        break;\n    }\n    return true;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case this.tag:\n        this.model.columns = this.map.tableColumns.model;\n        if (this.map.autoFilter.model) {\n          this.model.autoFilterRef = this.map.autoFilter.model.autoFilterRef;\n          this.map.autoFilter.model.columns.forEach((column, index) => {\n            this.model.columns[index].filterButton = column.filterButton;\n          });\n        }\n        this.model.style = this.map.tableStyleInfo.model;\n        return false;\n      default:\n        // could be some unrecognised tags\n        return true;\n    }\n  }\n\n  reconcile(model, options) {\n    // fetch the dfxs from styles\n    model.columns.forEach(column => {\n      if (column.dxfId !== undefined) {\n        column.style = options.styles.getDxfStyle(column.dxfId);\n      }\n    });\n  }\n}\n\nTableXform.TABLE_ATTRIBUTES = {\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n  'mc:Ignorable': 'xr xr3',\n  'xmlns:xr': 'http://schemas.microsoft.com/office/spreadsheetml/2014/revision',\n  'xmlns:xr3': 'http://schemas.microsoft.com/office/spreadsheetml/2016/revision3',\n  // 'xr:uid': '{00000000-000C-0000-FFFF-FFFF00000000}',\n};\n\nmodule.exports = TableXform;\n"],"mappings":"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"}